/* Timeline flip cards */
.event-card{ position: relative; perspective: 1600px; }
.event-card-inner{ position: relative; transform-style: preserve-3d; transition: transform 0.6s ease; }
.event-card-face{ border-radius: 0.75rem; background-color: #fff; transform-style: preserve-3d; transition: transform 0.6s ease, opacity 0.6s ease; box-shadow: 0 10px 15px -3px rgba(15,23,42,0.08), 0 4px 6px -4px rgba(15,23,42,0.08); }
.event-card-front{ position: relative; }
.event-card-front:hover{ box-shadow: 0 12px 20px -6px rgba(15,23,42,0.15); }
.event-card-back{ position: absolute; inset: 0; opacity: 0; pointer-events: none; transform: rotateY(-180deg); overflow: hidden; }
.event-card.flipped .event-card-inner{ transform: rotateY(180deg); }
.event-card.flipped .event-card-front{ transform: rotateY(180deg); opacity: 0; pointer-events: none; position: absolute; inset: 0; }
.event-card.flipped .event-card-back{ transform: rotateY(0deg); opacity: 1; pointer-events: auto; position: relative; overflow: auto; }
.event-intro-trigger{ border: 1px solid var(--c-primary-700); color: var(--c-primary-700); background-color: #fff; border-radius: 9999px; padding: 0.25rem 0.75rem; font-size: 0.75rem; font-weight: 600; transition: background-color 0.2s ease, color 0.2s ease; }
.event-intro-trigger:hover,
.event-intro-trigger:focus{ background-color: var(--c-primary-700); color: #fff; outline: none; box-shadow: 0 0 0 3px rgba(90,176,208,0.25); }
.event-intro-close{ color: var(--c-primary-700); font-weight: 600; font-size: 0.75rem; border-radius: 9999px; padding: 0.25rem 0.75rem; transition: background-color 0.2s ease, color 0.2s ease; }
.event-intro-close:hover,
.event-intro-close:focus{ background-color: rgba(90,176,208,0.1); outline: none; }

                { date: '7月18日-12月31日', venue: '奇美醫院', location: '奇美醫院2-5空橋', time: '全天', title: '奇美暖心角', type: '設施', description: '奇美暖心角設於第二與第五醫療大樓二樓間，讓空橋廊道不再只是通行動線，而是轉化為一條連接身體與心靈兩端的過渡帶。整體視覺設計採用墨綠色調，象徵一片靜謐的林地，宛如醫療場域中的「低調療癒者」，在來去匆匆的腳步聲中，悄然打開一扇通往內心的門，這是一處不需語言也能傳遞溫度的場域。', participants: '教學部、醫教會醫學人文組、藥劑部、院長室研發組' },
                { date: '11月1-16日', venue: '吳園', location: '吳園', time: '全天', title: '吳園特展', type: '展覽', description: '以醫學人文為主軸，展出醫療人員與病人的真實故事、醫學文化藝術，奇美小螺絲大力量的企業文化，並介紹奇美深耕臺南在地，為鄉親創造群體價值。點我看詳細說明：<a href="https://qpig0218.github.io/Wuyuan/" target="_blank" rel="noopener noreferrer" class="text-brand underline">前往活動頁面</a>', participants: '醫學人文組、藥劑部、護理部、教學部、奇美人以及Family、奇美學員、深耕計劃裡聯盟夥伴機構' },
                { date: '11月14-28日', venue: '奇美博物館', location: '奇美博物館布雷西亞廳', time: '全天', title: '布雷西亞廳特展', type: '展覽', description: '以年代為主軸，展示奇美醫院從創辦人夢想起源到今日深耕臺南的醫療設備與人員優化演進史。', participants: '院長室研發組、藥劑部、品管部、教學部、護理部、奇美人以及Family、奇美學員、深耕計劃裡聯盟夥伴機構' },
                { date: '11月15日', venue: '奇美博物館', location: '奇美博物館奇美廳豐收廳', time: '全天', title: '「雙管齊下、深耕臺南」-感染管制會議、重症感染研討會', type: '研討會', description: '聚焦專業議題，探討最新的感染管制策略與重症感染治療方法，提升醫療品質。', participants: '品質管理部、感染管制中心、臺南市衛生局' },
                { date: '11月16日', venue: '奇美博物館', location: '奇美博物館奇美廳豐收廳', time: '全天', title: '「雙管齊下、深耕臺南」-醫品病安願景實踐營（研討會與工作坊）', type: '共識營', description: '邀請國內外專家分享，主題涵蓋公平醫療體系、跨專業合作全人照護與智慧醫療轉型。', participants: '品質管理部、感染管制中心、臺灣醫療品質協會、國際專家' },
                { date: '11月21日', venue: '奇美醫院', location: '奇美醫院國際會議廳', time: '下午', title: '友善醫療日嘉年華', type: '嘉年華', description: '歡迎來到友善醫療日嘉年華！這是一場充滿歡樂、學習與健康的盛會。 點我看詳細說明：<a href="https://kampungtoh.github.io/CMHIVweb/" target="_blank" rel="noopener noreferrer" class="text-brand underline">前往活動頁面</a><br>打造友善醫療，成就健康未來<br>Equitable care 公平照護確保人人都能獲得符合需求的、高品質的醫療，不因身份、背景、疾病或經濟狀況而受限。公平照護能提升整體醫療效益，縮小健康差距，建立社會對醫療體系的信任，並體現醫療的價值。而友善醫療更是實現公平照護的關鍵。讓我們攜手，用同理與尊重，共創一個更健康、更無礙的醫療環境！', participants: '全院同仁' },
                { date: '11月22日', venue: '奇美博物館', location: '奇美博物館布雷西亞廳沙龍區', time: '上午', title: '醫學人文沙龍 & AMEE心得分享', type: '沙龍', description: '小規模深度交流，探討醫學人文實踐，並由同仁第一手分享國際醫學教育年會(AMEE)的最新趨勢與參與心得。', participants: 'Target Audience' },
                { date: '11月22日', venue: '奇美博物館', location: '奇美博物館豐收廳', time: '上午、下午', title: 'PGY說明會暨IPE工作坊', type: '說明會暨工作坊', description: '旨在介紹奇美醫院PGY培訓計劃、福利與未來發展優勢，同時透過多科部PGY的參與，加強跨專業團隊照護的精神。落實IPE、IPP、TRM。同時也會透過不同職類的計劃介紹，強化尊重多元團隊文化。', participants: 'PGY成員、各科PGY負責人、教學部' },
                { date: '11月22日', venue: '奇美博物館', location: '奇美博物館奇美廳', time: '全天', title: '2025 臺灣當代人物論壇', type: '論壇', description: `
                { date: '11月23日', venue: '奇美博物館', location: '奇美博物館布雷西亞廳沙龍區', time: '上午', title: 'PGY回娘家與海外留學Faculty Club', type: '短講、沙龍', description: '強化奇美人的連結，促進與他院的經驗交流；透過出國進修的心得分享，提供參與者思考多元職涯發展可能性，同時建立海外進修Faculty Club以及師生經驗分享平臺，逐步建立多元專業人才庫。', participants: '海外進修Faculty成員、、各醫事職類校友' },
                { date: '11月23日', venue: '奇美博物館', location: '奇美博物館布雷西亞廳沙龍區', time: '上午', title: '醫學教育AI數位賦能工作坊', type: '研討會', description: '內容：第一部分：奇美將AI技術創新應用於醫學教育的應用。第二部分：工作坊將手把手帶學員上機實戰，讓成員結束時有初步成果。點我看詳細說明：<a href="https://qpig0218.github.io/ChiMeiMonth-AIworkshop/" target="_blank" rel="noopener noreferrer" class="text-brand underline">前往活動頁面</a>', participants: '參賽團隊、數位賦能組、內部專家團隊、AI Everywhere 小組、藥劑部、院長室研發組、教學部、品管部' },
                { date: '11月23日', venue: '奇美博物館', location: '奇美博物館豐收廳', time: '下午', title: '「創造360°醫學人生」- 醫學教育共識營 ', type: '共識營', description: '為搭配教學組織改組，今年專注在奇美醫學教育的願景對齊，以及各功能小組以及執行單位的醫學教育共識。預計進行專題演講、教學型主治醫師醫教計劃報告以及共識工作坊，最後進入年度目標報告。點我看詳細說明：<a href="https://ling3567.github.io/ChiMeiMonth1123/camp?v=2" target="_blank" rel="noopener noreferrer" class="text-brand underline">前往活動頁面</a>', participants: '醫教委員、教學負責人、外部顧問貴賓' },

            const buildEventCard = (event) => {
                const eventIndex = eventsData.indexOf(event);
                const location = event.location || event.venue;
                const card = document.createElement('div');
                card.className = 'event-card fade-in';
                card.dataset.index = eventIndex;
                card.innerHTML = `
                    <div class="event-card-inner">
                        <div class="event-card-face event-card-front flex items-center space-x-4 p-4 cursor-pointer transition-shadow">
                            <div class="flex-shrink-0 text-center w-20">
                                <p class="font-bold text-lg text-brand">${event.date.split('月')[0]}月</p>
                                <p class="text-sm text-gray-500">${event.date.split('月')[1] || ''}</p>
                            </div>
                            <div class="border-l-2 border-stone-200 pl-4 flex-grow">
                                <p class="font-bold text-lg text-gray-800">${event.title}</p>
                                <p class="text-sm text-gray-500">${location} • ${event.time}</p>
                            </div>
                            <div class="flex-shrink-0 flex items-center gap-2">
                                <button type="button" class="event-intro-trigger" aria-expanded="false">活動介紹</button>
                                <span class="px-3 py-1 text-xs font-semibold rounded-full event-type">${event.type}</span>
                            </div>
                        </div>
                        <div class="event-card-face event-card-back p-4 space-y-3 text-left">
                            <div class="flex items-start justify-between gap-3">
                                <div>
                                    <p class="text-sm text-gray-500">${event.date}｜${event.time}</p>
                                    <p class="text-sm text-gray-700 font-medium">${location}</p>
                                </div>
                                <button type="button" class="event-intro-close" aria-label="返回活動卡片">返回</button>
                            </div>
                            <div class="event-card-description text-sm text-gray-600 leading-relaxed">${event.description}</div>
                            <div class="event-card-participants bg-stone-50 rounded-lg p-3">
                                <p class="text-xs font-semibold text-gray-700">主要參與單位/人員</p>
                                <p class="text-xs text-gray-600 mt-1">${event.participants}</p>
                            </div>
                        </div>
                    </div>
                `;

                const introTrigger = card.querySelector('.event-intro-trigger');
                const introClose = card.querySelector('.event-intro-close');

                const setExpanded = (expanded) => {
                    if (introTrigger) {
                        introTrigger.setAttribute('aria-expanded', expanded ? 'true' : 'false');
                    }
                };

                setExpanded(false);

                if (introTrigger && introClose) {
                    introTrigger.addEventListener('click', (ev) => {
                        ev.preventDefault();
                        ev.stopPropagation();
                        card.classList.add('flipped');
                        setExpanded(true);
                        introClose.focus();
                    });

                    introClose.addEventListener('click', (ev) => {
                        ev.preventDefault();
                        ev.stopPropagation();
                        card.classList.remove('flipped');
                        setExpanded(false);
                        introTrigger.focus();
                    });
                }

                card.addEventListener('keydown', (ev) => {
                    if (ev.key === 'Escape' && card.classList.contains('flipped')) {
                        card.classList.remove('flipped');
                        setExpanded(false);
                        if (introTrigger) {
                            introTrigger.focus();
                        }
                    }
                });

                return card;
            };
                filteredEvents.forEach((event) => {
                    const eventElement = buildEventCard(event);
                if (e.target.closest('.event-intro-trigger') || e.target.closest('.event-intro-close')) {
                    return;
                }
                if (eventCard && !eventCard.classList.contains('flipped')) {
                    const eventIndex = parseInt(eventCard.dataset.index, 10);
        const el = buildEventCard(event);
    filteredEvents.forEach((event) => {
      const eventElement = buildEventCard(event);
